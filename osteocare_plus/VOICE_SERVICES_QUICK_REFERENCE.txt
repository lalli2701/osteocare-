üì± VOICE SERVICES QUICK REFERENCE
==================================

üé§ VOICE SERVICE (TTS)
======================

What: Text-to-Speech engine with dynamic language switching

Initialize:
  await VoiceService().initialize();

Set Language:
  await VoiceService().switchLanguage('hi'); // 'en', 'hi', 'te'

Speak Text:
  await VoiceService().speak("Question 5 of 15...");

Build Question Voice Script:
  final script = VoiceService().buildQuestionVoiceScript(
    currentIndex: 5,
    totalQuestions: 15,
    questionText: "Has a doctor told you...",
    options: ["Yes", "No"],
  );
  await VoiceService().speak(script);

Get User Prompts (in current language):
  getConfirmationPrompt("Yes")      // "You said: Yes. Is that correct?"
  getRetryPrompt()                   // "I could not understand..."
  getNumberPrompt("age")             // "Please say your age..."

Stop Speaking:
  await VoiceService().stop();

Check if Speaking:
  bool speaking = VoiceService().isSpeaking;

Current Language:
  VoiceLanguage lang = VoiceService().currentLanguage;

Cleanup:
  await VoiceService().dispose();


üéôÔ∏è SPEECH RECOGNITION SERVICE (STT)
====================================

What: Speech-to-Text with multilingual keyword mapping

Initialize:
  final available = await SpeechRecognitionService().initialize();

Set Language:
  await SpeechRecognitionService().setLanguage('hi');

Start Listening:
  await SpeechRecognitionService().startListening(
    onResult: (transcript) {
      final result = SpeechRecognitionService().parseYesNoAnswer(transcript);
      // RecognitionResult.yes | .no | .alternative | .unknown
    },
    onError: () {
      // Error occurred
    },
  );

Parse Yes/No Answer:
  final result = SpeechRecognitionService().parseYesNoAnswer("‡§π‡§æ‡§Å");
  // Returns: RecognitionResult.yes

Extract Number:
  final age = SpeechRecognitionService().extractNumber("twenty five");
  // Returns: 25

Get Display Text:
  final text = SpeechRecognitionService().getDisplayText(
    transcript,
    RecognitionResult.yes,
  );
  // In Hindi: "‡§π‡§æ‡§Å"
  // In English: "Yes"

Stop Listening:
  await SpeechRecognitionService().stopListening();

Check Availability:
  bool available = SpeechRecognitionService().isAvailable;
  bool listening = SpeechRecognitionService().isListening;

Cleanup:
  await SpeechRecognitionService().dispose();


üìä MULTILINGUAL KEYWORD MAPPING
================================

English:
  Yes: yes, yeah, yup, sure, okay, ok, correct, right, affirmative
  No: no, nope, nah, negative, never, not, false

Hindi:
  Yes: haan, haa, ham, bilkul, theek, sahi
  No: nahi, nahin, na, bilkul nahi, kabhi nahi

Telugu:
  Yes: avunu, aavanu, oka, kosu
  No: kaadu, kadu, ledu, lenu


üîó LANGUAGE SERVICE INTEGRATION
================================

When Language Changes:
  1. LanguageService.changeLanguage(context, language)
  2. Automatically syncs VoiceService
  3. Automatically syncs SpeechRecognitionService
  4. Saves to SharedPreferences
  5. Sends to backend

Example:
  await LanguageService.changeLanguage(context, AppLanguage.hindi);
  // Automatically:
  // - Sets app locale to 'hi'
  // - Sets VoiceService to 'hi-IN'
  // - Sets SpeechRecognitionService to 'hi_IN'
  // - Saves 'en' to SharedPreferences
  // - POSTs to backend


üìã VOICE ANSWER FLOW (Step-by-Step)
====================================

1. Question Loads
   ‚îî‚îÄ Load translated question from SurveyService
   ‚îî‚îÄ Set VoiceService language: 'hi-IN'
   ‚îî‚îÄ Set SpeechRecognitionService language: 'hi_IN'

2. Question Display
   ‚îî‚îÄ Show question text
   ‚îî‚îÄ Show voice toggle button
   ‚îî‚îÄ Auto-read question (or user taps voice icon)

3. Build Voice Script
   script = VoiceService().buildQuestionVoiceScript(...)
   
   Example (Hindi):
   "15 ‡§Æ‡•á‡§Ç ‡§∏‡•á 5‡§µ‡§æ‡§Å ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§®‡•á...? ‡§ï‡•É‡§™‡§Ø‡§æ ‡§π‡§æ‡§Å ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§π‡•á‡§Ç‡•§"

4. Read Question via TTS
   await VoiceService().speak(script);

5. User Taps Mic Button
   ‚îî‚îÄ Stop current TTS
   ‚îî‚îÄ Start SpeechRecognitionService
   ‚îî‚îÄ Set locale to 'hi_IN'

6. User Speaks Answer
   ‚îî‚îÄ "‡§π‡§æ‡§Å"

7. Parse Speech
   transcript = "‡§π‡§æ‡§Å"
   result = SpeechRecognitionService().parseYesNoAnswer(transcript)
   # Returns: RecognitionResult.yes

8. Get Display Text
   display = SpeechRecognitionService().getDisplayText(
     "‡§π‡§æ‡§Å",
     RecognitionResult.yes,
   )
   # Returns: "‡§π‡§æ‡§Å" (localized)

9. Show Confirmation
   "‡§Ü‡§™‡§®‡•á ‡§ï‡§π‡§æ: ‡§π‡§æ‡§Å‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§∏‡§π‡•Ä ‡§π‡•à?"
   Buttons: [Confirm] [Retry]

10. User Confirms
    ‚îî‚îÄ Store answer: {"arthritis": "Yes"}
    ‚îî‚îÄ Move to next question

OR User Retries
    ‚îî‚îÄ Speak retry prompt: "‡§Æ‡•Å‡§ù‡•á ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§Ø‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§"
    ‚îî‚îÄ Restart listening


‚ö†Ô∏è CRITICAL NOTES
=================

‚úÖ DO:
   - Always check voice availability before using
   - Show confirmation dialog before accepting voice answer
   - Stop TTS before starting speech recognition
   - Handle speech recognition failure gracefully
   - Match TTS language with speech recognition locale
   - Send only structured answers ({"arthritis": "Yes"})

‚ùå DON'T:
   - Auto-submit after speech recognition
   - Send raw transcript to backend
   - Mix languages in same question
   - Switch locale without stopping TTS/STT first
   - Use voice for complex data (height, weight)
   - Translate survey questions on backend


üîå BACKEND INTEGRATION
======================

Voice Preference Storage:

Database:
  users table:
    - voice_enabled BOOLEAN DEFAULT 1
    - preferred_language VARCHAR DEFAULT 'english'

API Endpoints:

1. Get Voice Preference (in /api/dashboard response):
   {
     "user": {...},
     "voice_enabled": true,
     "preferred_language": "hindi"
   }

2. Update Voice Preference:
   POST /api/user/preferences
   {"voice_enabled": false}

3. Update Language Preference:
   POST /api/user/preferences
   {"preferred_language": "hindi"}

Backend Rules:
  - NEVER translate on backend
  - NEVER process speech transcripts
  - ONLY store language preference
  - ONLY return structured data
  - Model receives language-neutral data


üéØ INTEGRATION CHECKLIST
========================

Before survey page uses voice:
  [ ] VoiceService implemented (‚úì)
  [ ] SpeechRecognitionService implemented (‚úì)
  [ ] LanguageService syncs with both services (‚úì)
  [ ] Survey questions load in user's language (‚úì)
  [ ] Voice button added to each question
  [ ] Confirmation dialog shown for voice answers
  [ ] Fallback to text input if voice unavailable
  [ ] Cleanup on page exit
  [ ] Test with multiple languages
  [ ] Test microphone permission handling
  [ ] Test network errors gracefully

